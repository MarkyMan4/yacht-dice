import"./style.c0ed6924.js";let g=sessionStorage.getItem("roomId"),y=sessionStorage.getItem("nickname"),d="",c=!1,f=document.getElementById("roll-btn"),I=document.getElementById("p1-upper-sum"),T=document.getElementById("p2-upper-sum"),B=document.getElementById("p1-total"),L=document.getElementById("p2-total"),s=document.getElementById("message-text"),$=document.getElementById("rolls-left-text"),u=document.getElementById("play-again-btn"),E="";u.addEventListener("click",e=>P());const a=["aces","deuces","threes","fours","fives","sixes","fourOfAKind","fullHouse","smallStraight","largeStraight","chance","yacht"];let p=new WebSocket(`wss://yachtdiceservice.xyz/ws/${g}`);p.onmessage=e=>{let t=JSON.parse(e.data);if(c||(v(t),c=!0),k(t),w(t),t.winner.trim()!=""){t.winner==="tie"?s.innerHTML="tie":s.innerHTML=`${t.winner} wins!`,s.style.color="blue",u.style.display="block";return}N(t),H(t),f.disabled=t.turn!==d||t.rollsLeft<=0,$.innerHTML=`rolls left: ${t.rollsLeft}`,t.turn===d&&t.rollsLeft<3?M(t.scoreCard[d]):S(t.scoreCard[d])};p.onopen=e=>{r({eventType:"name",payload:{name:y}})};f.addEventListener("click",()=>{r({eventType:"roll"})});function r(e){E=e.eventType,p.send(JSON.stringify(e))}function v(e){document.getElementById("waiting-text")&&document.getElementById("waiting-text").remove(),document.getElementById("game").style.visibility="visible",d=e.p1.nickname===y?"p1":"p2",document.getElementById("you-title").innerHTML=`You are ${d}`,document.getElementById("p1-head").innerHTML=`p1<br>${e.p1.nickname}`,document.getElementById("p2-head").innerHTML=`p2<br>${e.p2.nickname}`}function k(e){m("p1",e.scoreCard.p1),m("p2",e.scoreCard.p2),I.innerHTML=e.upperTotals.p1,T.innerHTML=e.upperTotals.p2,B.innerHTML=e.totals.p1,L.innerHTML=e.totals.p2}function m(e,t){let n=Object.keys(t);n.forEach(l=>{document.getElementById(`${e}-${l}`).innerHTML=t[l],document.getElementById(`${e}-${l}`).className="scored-cell"}),a.forEach(l=>{n.includes(l)||(document.getElementById(`${e}-${l}`).innerHTML="")})}function H(e){Object.keys(e.scoreHints).forEach(t=>{document.getElementById(`${e.turn}-${t}`).innerHTML=e.scoreHints[t],document.getElementById(`${e.turn}-${t}`).className="unscored-cell"})}function M(e){let t=Object.keys(e);a.forEach(n=>{t.includes(n)||(document.getElementById(`${d}-${n}`).onclick=b,document.getElementById(`${d}-${n}`).className="selectable-cell")})}function S(e){let t=Object.keys(e);a.forEach(n=>{document.getElementById(`${d}-${n}`).onclick=null,t.includes(n)||(document.getElementById(`${d}-${n}`).className="unscored-cell")})}function b(e){let t=e.target.id.split("-"),l={eventType:"score",payload:{category:t[t.length-1]}};r(l)}function h(e){let t=e.target.id.split("-"),l={eventType:"keep",payload:{die:parseInt(t[t.length-1])}};r(l)}function x(e){let t=e.target.id.split("-"),l={eventType:"unkeep",payload:{die:parseInt(t[t.length-1])}};r(l)}function w(e){let t="";for(let i=0;i<e.diceInPlay.length;i++){let o=e.diceInPlay[i];t+=`<div id="die-in-play-${i}" class="die-in-play">${o}</div>`}document.getElementById("dice-in-play").innerHTML=t;let n="";for(let i=0;i<e.diceKept.length;i++){let o=e.diceKept[i];n+=`<div id="die-kept-${i}" class="die-kept">${o}</div>`}if(document.getElementById("dice-kept").innerHTML=n,e.rollsLeft>=3)return;let l=document.getElementsByClassName("die-in-play");for(let i of l)E==="roll"&&(i.style.animationName="dice-roll-anim",i.style.animationDuration="0.5s");if(e.turn===d){for(let o of l)o.addEventListener("click",h);let i=document.getElementsByClassName("die-kept");for(let o of i)o.addEventListener("click",x)}}function N(e){e.turn===d?s.innerHTML="your turn":s.innerHTML=`${e.turn} is rolling...`,s.style.color="red"}function P(){u.style.display="none",c=!1,s.innerHTML="",r({eventType:"restart"})}
